<!DOCTYPE html>
<html>
<head>
    <title>Horarios del Médico</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="schedule-root"></div>

    <script type="text/babel">
        function ScheduleInterface() {
            const [date, setDate] = React.useState(new Date());
            const [selectedTime, setSelectedTime] = React.useState(null);
            const [confirmedTime, setConfirmedTime] = React.useState(null); // Nuevo estado para almacenar la cita confirmada
            const [availableTimeSlots, setAvailableTimeSlots] = React.useState([
                { time: '09:00', available: true },
                { time: '09:30', available: true },
                { time: '10:00', available: false },
                { time: '10:30', available: true },
                { time: '11:00', available: true },
                { time: '11:30', available: false },
                { time: '12:00', available: true },
                { time: '12:30', available: true },
                { time: '15:00', available: true },
                { time: '15:30', available: true },
                { time: '16:00', available: true },
                { time: '16:30', available: false },
            ]);

            const handleTimeSelect = (time) => {
                setSelectedTime(time);
            };

            const handleConfirmAppointment = () => {
                setAvailableTimeSlots(prevSlots =>
                    prevSlots.map(slot =>
                        slot.time === selectedTime ? { ...slot, available: false } : slot
                    )
                );
                setConfirmedTime(selectedTime); // Guardar la cita confirmada
                setSelectedTime(null); // Limpiar selección
            };

            const handleCancelAppointment = () => {
                setAvailableTimeSlots(prevSlots =>
                    prevSlots.map(slot =>
                        slot.time === confirmedTime ? { ...slot, available: true } : slot
                    )
                );
                setConfirmedTime(null); // Limpiar la cita confirmada
            };

            return (
                <div className="max-w-4xl mx-auto p-4">
                    <div className="bg-white shadow-lg rounded-lg">
                        <div className="p-4 border-b">
                            <h2 className="text-xl font-bold">{{ medic.name }} • Horarios Disponibles</h2>
                            <p className="text-sm text-gray-500 mt-1">{{ medic.area }} - RUT: {{ medic.rut }}</p>
                        </div>
                        <div className="p-4">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <input
                                        type="date"
                                        className="w-full p-2 border rounded"
                                        onChange={(e) => setDate(new Date(e.target.value))}
                                        min={new Date().toISOString().slice(0, 10)}
                                    />
                                </div>
                                <div className="grid grid-cols-2 gap-2">
                                    {availableTimeSlots.map((slot) => (
                                        <button
                                            key={slot.time}
                                            disabled={!slot.available}
                                            onClick={() => handleTimeSelect(slot.time)}
                                            className={`
                                                p-2 rounded
                                                ${!slot.available ? 'bg-gray-100 text-gray-400' :
                                                selectedTime === slot.time ? 'bg-blue-500 text-white' :
                                                'bg-white border hover:bg-gray-50'}
                                            `}
                                        >
                                            {slot.time}
                                            {!slot.available && <span className="ml-2 text-xs">(No disponible)</span>}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {selectedTime && (
                                <div className="mt-4 p-4 bg-blue-50 rounded">
                                    <p className="text-center">
                                        Cita seleccionada para el {new Date(date.getTime() + date.getTimezoneOffset() * 60000).toLocaleDateString()} a las {selectedTime}
                                    </p>

                                    <div className="flex justify-center mt-2">
                                        <button
                                            onClick={handleConfirmAppointment}
                                            className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                        >
                                            Confirmar Cita
                                        </button>
                                    </div>
                                </div>
                            )}

                            {confirmedTime && (
                                <div className="mt-4 p-4 bg-red-50 rounded">
                                    <p className="text-center">
                                        Cita confirmada para el {new Date(date.getTime() + date.getTimezoneOffset() * 60000).toLocaleDateString()} a las {confirmedTime}
                                    </p>
                                    <div className="flex justify-center mt-2">
                                        <button
                                            onClick={handleCancelAppointment}
                                            className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
                                        >
                                            Cancelar Cita
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(
            <ScheduleInterface />,
            document.getElementById('schedule-root')
        );
    </script>

</body>
</html>
