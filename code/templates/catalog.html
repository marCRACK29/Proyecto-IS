<!DOCTYPE html>

<html>
	<head>
		<meta charset = "UTF-8">
		<title> Grafico de Medicos </title>
		
		<link rel = "stylesheet" href = "{{ url_for('static', filename='style.css') }}">
		<link rel = "stylesheet" href = "https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
		
		<script src = "https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<script src = "https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
	</head>
	
	<body>
        <label for="specialityFilter">Filtrar por especialidad:</label>
        <select id="specialityFilter">
            <option value="">Todas</option>
        </select>

		<h1> Catálogo de Médicos </h1>
		<table id = "catalog" class = "display">
			<thead>
				<tr>
					<th> Nombre </th>
					<th> Especialidad </th>
				</tr>
			</thead>
			
			<tbody>
			</tbody>
		</table>
		
		<script>
			async function fetchMedics() {
				const rawData = await fetch('/api/medics'); // llama a funcion getMedics
				const medicData = await rawData.json();

                // Llenar el selector de especialidades
                const specialities = [...new Set(medicData.map(m => m.speciality))];
                const specialityFilter = document.getElementById('specialityFilter');
                specialities.forEach(speciality => {
                    const option = document.createElement('option');
                    option.value = speciality;
                    option.textContent = speciality;
                    specialityFilter.appendChild(option);
                });

                // Iniciar tabla
                const table = $('#catalog').DataTable({
					data: medicData,
					columns: [
						{
							data: 'name',
							render: function(data) {
								return `<a href="/medic/${data}">${data}</a>`;
							}
						},
						{ data: 'speciality' }
					],
				});

                // Filtrar la tabla al cambiar la especialidad
                specialityFilter.addEventListener('change', async () => {
                    const selectedSpeciality = specialityFilter.value;
                    let filteredData;

                    if (selectedSpeciality) {
                        const filteredRawData = await fetch(`/api/medics/filter/${selectedSpeciality}`);
                        filteredData = await filteredRawData.json();
                    } else {
                        filteredData = medicData;
                    }

                    table.clear().rows.add(filteredData).draw();
                });
			}

			fetchMedics();
		</script>
	</body>
</html>